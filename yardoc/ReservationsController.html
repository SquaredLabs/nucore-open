<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  Class: ReservationsController
  
    &mdash; Documentation by YARD 0.9.12
  
</title>

  <link rel="stylesheet" href="css/style.css" type="text/css" charset="utf-8" />

  <link rel="stylesheet" href="css/common.css" type="text/css" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  pathId = "ReservationsController";
  relpath = '';
</script>


  <script type="text/javascript" charset="utf-8" src="js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="js/app.js"></script>


  </head>
  <body>
    <div class="nav_wrap">
      <iframe id="nav" src="class_list.html?1"></iframe>
      <div id="resizer"></div>
    </div>

    <div id="main" tabindex="-1">
      <div id="header">
        <div id="menu">
  
    <a href="_index.html">Index (R)</a> &raquo;
    
    
    <span class="title">ReservationsController</span>
  
</div>

        <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="class_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
        <div class="clear"></div>
      </div>

      <div id="content"><h1>Class: ReservationsController
  
  
  
</h1>
<div class="box_info">
  
  <dl>
    <dt>Inherits:</dt>
    <dd>
      <span class="inheritName"><span class='object_link'><a href="ApplicationController.html" title="ApplicationController (class)">ApplicationController</a></span></span>
      
        <ul class="fullTree">
          <li>Object</li>
          
            <li class="next">ActionController::Base</li>
          
            <li class="next"><span class='object_link'><a href="ApplicationController.html" title="ApplicationController (class)">ApplicationController</a></span></li>
          
            <li class="next">ReservationsController</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
    </dd>
  </dl>
  

  
  
  
  
  <dl>
      <dt>Includes:</dt>
      <dd><span class='object_link'><a href="FacilityReservationsHelper.html" title="FacilityReservationsHelper (module)">FacilityReservationsHelper</a></span>, <span class='object_link'><a href="Timelineable.html" title="Timelineable (module)">Timelineable</a></span>, <span class='object_link'><a href="TranslationHelper.html" title="TranslationHelper (module)">TranslationHelper</a></span></dd>
  </dl>
  
  

  

  
  <dl>
    <dt>Defined in:</dt>
    <dd>app/controllers/reservations_controller.rb</dd>
  </dl>
  
</div>




  <h2>Constant Summary</h2>
  
  <h3 class="inherited">Constants included
     from <span class='object_link'><a href="DateHelper.html" title="DateHelper (module)">DateHelper</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="DateHelper.html#USA_DATE_FORMAT-constant" title="DateHelper::USA_DATE_FORMAT (constant)">DateHelper::USA_DATE_FORMAT</a></span></p>




  <h2>Instance Attribute Summary</h2>
  
  <h3 class="inherited">Attributes inherited from <span class='object_link'><a href="ApplicationController.html" title="ApplicationController (class)">ApplicationController</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="ApplicationController.html#active_tab-instance_method" title="ApplicationController#active_tab (method)">#active_tab</a></span></p>


  
    <h2>
      Instance Method Summary
      <small><a href="#" class="summary_toggle">collapse</a></small>
    </h2>

    <ul class="summary">
      
        <li class="private ">
  <span class="summary_signature">
    
      <a href="#ability_resource-instance_method" title="#ability_resource (instance method)">#<strong>ability_resource</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  <span class="note title private">private</span>
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="private ">
  <span class="summary_signature">
    
      <a href="#changes_valid_for_update%3F-instance_method" title="#changes_valid_for_update? (instance method)">#<strong>changes_valid_for_update?</strong>  &#x21d2; Boolean </a>
    

    
  </span>
  
  
  
  <span class="note title private">private</span>
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#create-instance_method" title="#create (instance method)">#<strong>create</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>POST /orders/:order_id/order_details/:order_detail_id/reservations.</p>
</div></span>
  
</li>

      
        <li class="private ">
  <span class="summary_signature">
    
      <a href="#default_reservation-instance_method" title="#default_reservation (instance method)">#<strong>default_reservation</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  <span class="note title private">private</span>
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="private ">
  <span class="summary_signature">
    
      <a href="#default_reservation_mins-instance_method" title="#default_reservation_mins (instance method)">#<strong>default_reservation_mins</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  <span class="note title private">private</span>
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="private ">
  <span class="summary_signature">
    
      <a href="#duration_change_valid%3F-instance_method" title="#duration_change_valid? (instance method)">#<strong>duration_change_valid?</strong>  &#x21d2; Boolean </a>
    

    
  </span>
  
  
  
  <span class="note title private">private</span>
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#earliest_move_possible-instance_method" title="#earliest_move_possible (instance method)">#<strong>earliest_move_possible</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>GET
/orders/:order_id/order_details/:order_detail_id/reservations/:reservation_id/move.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#edit-instance_method" title="#edit (instance method)">#<strong>edit</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>GET /orders/1/order_details/1/reservations/1/edit.</p>
</div></span>
  
</li>

      
        <li class="private ">
  <span class="summary_signature">
    
      <a href="#editable_by_current_user%3F-instance_method" title="#editable_by_current_user? (instance method)">#<strong>editable_by_current_user?</strong>  &#x21d2; Boolean </a>
    

    
  </span>
  
  
  
  <span class="note title private">private</span>
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="private ">
  <span class="summary_signature">
    
      <a href="#fixed_start_time%3F-instance_method" title="#fixed_start_time? (instance method)">#<strong>fixed_start_time?</strong>  &#x21d2; Boolean </a>
    

    
  </span>
  
  
  
  <span class="note title private">private</span>
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="private ">
  <span class="summary_signature">
    
      <a href="#helpers-instance_method" title="#helpers (instance method)">#<strong>helpers</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  <span class="note title private">private</span>
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#index-instance_method" title="#index (instance method)">#<strong>index</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>GET
/facilities/1/instruments/1/reservations.js?_=1279579838269&amp;start=1279429200&amp;end=1280034000.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#initialize-instance_method" title="#initialize (instance method)">#<strong>initialize</strong>  &#x21d2; ReservationsController </a>
    

    
  </span>
  
  
    <span class="note title constructor">constructor</span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>A new instance of ReservationsController.</p>
</div></span>
  
</li>

      
        <li class="private ">
  <span class="summary_signature">
    
      <a href="#invalid_for_update%3F-instance_method" title="#invalid_for_update? (instance method)">#<strong>invalid_for_update?</strong>  &#x21d2; Boolean </a>
    

    
  </span>
  
  
  
  <span class="note title private">private</span>
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>TODO: you shouldn&#39;t be able to edit reservations that have passed or
are outside of the cancellation period (check to make sure order has been
placed).</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#list-instance_method" title="#list (instance method)">#<strong>list</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>GET /reservations All My Resesrvations.</p>
</div></span>
  
</li>

      
        <li class="private ">
  <span class="summary_signature">
    
      <a href="#load_and_check_resources-instance_method" title="#load_and_check_resources (instance method)">#<strong>load_and_check_resources</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  <span class="note title private">private</span>
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="private ">
  <span class="summary_signature">
    
      <a href="#load_basic_resources-instance_method" title="#load_basic_resources (instance method)">#<strong>load_basic_resources</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  <span class="note title private">private</span>
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="private ">
  <span class="summary_signature">
    
      <a href="#max_reservation_window-instance_method" title="#max_reservation_window (instance method)">#<strong>max_reservation_window</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  <span class="note title private">private</span>
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="private ">
  <span class="summary_signature">
    
      <a href="#month_view%3F-instance_method" title="#month_view? (instance method)">#<strong>month_view?</strong>  &#x21d2; Boolean </a>
    

    
  </span>
  
  
  
  <span class="note title private">private</span>
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>`1.week` causes a problem with daylight saving week since it&#39;s
technically longer than a week.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#move-instance_method" title="#move (instance method)">#<strong>move</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>POST
/orders/:order_id/order_details/:order_detail_id/reservations/:reservation_id/move.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#new-instance_method" title="#new (instance method)">#<strong>new</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>GET /orders/:order_id/order_details/:order_detail_id/reservations/new.</p>
</div></span>
  
</li>

      
        <li class="private ">
  <span class="summary_signature">
    
      <a href="#notice_for_reservation-instance_method" title="#notice_for_reservation (instance method)">#<strong>notice_for_reservation</strong>(reservation)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  <span class="note title private">private</span>
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#public_timeline-instance_method" title="#public_timeline (instance method)">#<strong>public_timeline</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="private ">
  <span class="summary_signature">
    
      <a href="#render_edit-instance_method" title="#render_edit (instance method)">#<strong>render_edit</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  <span class="note title private">private</span>
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="private ">
  <span class="summary_signature">
    
      <a href="#reservation_params-instance_method" title="#reservation_params (instance method)">#<strong>reservation_params</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  <span class="note title private">private</span>
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="private ">
  <span class="summary_signature">
    
      <a href="#reservation_start_as_params-instance_method" title="#reservation_start_as_params (instance method)">#<strong>reservation_start_as_params</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  <span class="note title private">private</span>
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="private ">
  <span class="summary_signature">
    
      <a href="#save_reservation_and_order_detail-instance_method" title="#save_reservation_and_order_detail (instance method)">#<strong>save_reservation_and_order_detail</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  <span class="note title private">private</span>
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="private ">
  <span class="summary_signature">
    
      <a href="#set_windows-instance_method" title="#set_windows (instance method)">#<strong>set_windows</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  <span class="note title private">private</span>
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#show-instance_method" title="#show (instance method)">#<strong>show</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>GET
/orders/:order_id/order_details/:order_detail_id/reservations/:id(.:format).</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#switch_instrument-instance_method" title="#switch_instrument (instance method)">#<strong>switch_instrument</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>GET
/orders/:order_id/order_details/:order_detail_id/reservations/switch_instrument.</p>
</div></span>
  
</li>

      
        <li class="private ">
  <span class="summary_signature">
    
      <a href="#switch_instrument_off!-instance_method" title="#switch_instrument_off! (instance method)">#<strong>switch_instrument_off!</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  <span class="note title private">private</span>
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="private ">
  <span class="summary_signature">
    
      <a href="#switch_instrument_on!-instance_method" title="#switch_instrument_on! (instance method)">#<strong>switch_instrument_on!</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  <span class="note title private">private</span>
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="private ">
  <span class="summary_signature">
    
      <a href="#upcoming_today%3F-instance_method" title="#upcoming_today? (instance method)">#<strong>upcoming_today?</strong>(reservation)  &#x21d2; Boolean </a>
    

    
  </span>
  
  
  
  <span class="note title private">private</span>
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#update-instance_method" title="#update (instance method)">#<strong>update</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>PUT  /orders/1/order_details/1/reservations/1.</p>
</div></span>
  
</li>

      
    </ul>
  


  
  
  
  
  
  
  
  
  <h3 class="inherited">Methods included from <span class='object_link'><a href="FacilityReservationsHelper.html" title="FacilityReservationsHelper (module)">FacilityReservationsHelper</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="FacilityReservationsHelper.html#admin_category_collection-instance_method" title="FacilityReservationsHelper#admin_category_collection (method)">#admin_category_collection</a></span>, <span class='object_link'><a href="FacilityReservationsHelper.html#edit_admin_reservation_path-instance_method" title="FacilityReservationsHelper#edit_admin_reservation_path (method)">#edit_admin_reservation_path</a></span>, <span class='object_link'><a href="FacilityReservationsHelper.html#link_to_cancel-instance_method" title="FacilityReservationsHelper#link_to_cancel (method)">#link_to_cancel</a></span>, <span class='object_link'><a href="FacilityReservationsHelper.html#offline_category_collection-instance_method" title="FacilityReservationsHelper#offline_category_collection (method)">#offline_category_collection</a></span>, <span class='object_link'><a href="FacilityReservationsHelper.html#reservation_category_label-instance_method" title="FacilityReservationsHelper#reservation_category_label (method)">#reservation_category_label</a></span>, <span class='object_link'><a href="FacilityReservationsHelper.html#reservation_links-instance_method" title="FacilityReservationsHelper#reservation_links (method)">#reservation_links</a></span></p>

  
  
  
  
  
  
  
  
  <h3 class="inherited">Methods included from <span class='object_link'><a href="TranslationHelper.html" title="TranslationHelper (module)">TranslationHelper</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="TranslationHelper.html#t_boolean-instance_method" title="TranslationHelper#t_boolean (method)">#t_boolean</a></span>, <span class='object_link'><a href="TranslationHelper.html#t_create_model-instance_method" title="TranslationHelper#t_create_model (method)">#t_create_model</a></span>, <span class='object_link'><a href="TranslationHelper.html#t_create_models-instance_method" title="TranslationHelper#t_create_models (method)">#t_create_models</a></span>, <span class='object_link'><a href="TranslationHelper.html#t_manage_models-instance_method" title="TranslationHelper#t_manage_models (method)">#t_manage_models</a></span>, <span class='object_link'><a href="TranslationHelper.html#t_model_error-instance_method" title="TranslationHelper#t_model_error (method)">#t_model_error</a></span>, <span class='object_link'><a href="TranslationHelper.html#t_my-instance_method" title="TranslationHelper#t_my (method)">#t_my</a></span></p>

  
  
  
  
  
  
  
  
  <h3 class="inherited">Methods included from <span class='object_link'><a href="Timelineable.html" title="Timelineable (module)">Timelineable</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="Timelineable.html#display_date_as_time-instance_method" title="Timelineable#display_date_as_time (method)">#display_date_as_time</a></span>, <span class='object_link'><a href="Timelineable.html#timeline-instance_method" title="Timelineable#timeline (method)">#timeline</a></span></p>

  
  
  
  
  
  
  
  
  
  <h3 class="inherited">Methods inherited from <span class='object_link'><a href="ApplicationController.html" title="ApplicationController (class)">ApplicationController</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="ApplicationController.html#acting_as%3F-instance_method" title="ApplicationController#acting_as? (method)">#acting_as?</a></span>, <span class='object_link'><a href="ApplicationController.html#acting_user-instance_method" title="ApplicationController#acting_user (method)">#acting_user</a></span>, <span class='object_link'><a href="ApplicationController.html#after_sign_out_path_for-instance_method" title="ApplicationController#after_sign_out_path_for (method)">#after_sign_out_path_for</a></span>, <span class='object_link'><a href="ApplicationController.html#backend%3F-instance_method" title="ApplicationController#backend? (method)">#backend?</a></span>, <span class='object_link'><a href="ApplicationController.html#check_acting_as-instance_method" title="ApplicationController#check_acting_as (method)">#check_acting_as</a></span>, <span class='object_link'><a href="ApplicationController.html#check_billing_access-instance_method" title="ApplicationController#check_billing_access (method)">#check_billing_access</a></span>, <span class='object_link'><a href="ApplicationController.html#cross_facility%3F-instance_method" title="ApplicationController#cross_facility? (method)">#cross_facility?</a></span>, <span class='object_link'><a href="ApplicationController.html#current_ability-instance_method" title="ApplicationController#current_ability (method)">#current_ability</a></span>, <span class='object_link'><a href="ApplicationController.html#current_cart-instance_method" title="ApplicationController#current_cart (method)">#current_cart</a></span>, <span class='object_link'><a href="ApplicationController.html#current_facility-instance_method" title="ApplicationController#current_facility (method)">#current_facility</a></span>, <span class='object_link'><a href="ApplicationController.html#empty_params-instance_method" title="ApplicationController#empty_params (method)">#empty_params</a></span>, <span class='object_link'><a href="ApplicationController.html#init_current_account-instance_method" title="ApplicationController#init_current_account (method)">#init_current_account</a></span>, <span class='object_link'><a href="ApplicationController.html#init_current_facility-instance_method" title="ApplicationController#init_current_facility (method)">#init_current_facility</a></span>, <span class='object_link'><a href="ApplicationController.html#manageable_facilities-instance_method" title="ApplicationController#manageable_facilities (method)">#manageable_facilities</a></span>, <span class='object_link'><a href="ApplicationController.html#open_or_facility_path-instance_method" title="ApplicationController#open_or_facility_path (method)">#open_or_facility_path</a></span>, <span class='object_link'><a href="ApplicationController.html#operable_facilities-instance_method" title="ApplicationController#operable_facilities (method)">#operable_facilities</a></span>, <span class='object_link'><a href="ApplicationController.html#render_403-instance_method" title="ApplicationController#render_403 (method)">#render_403</a></span>, <span class='object_link'><a href="ApplicationController.html#render_404-instance_method" title="ApplicationController#render_404 (method)">#render_404</a></span>, <span class='object_link'><a href="ApplicationController.html#render_acting_error-instance_method" title="ApplicationController#render_acting_error (method)">#render_acting_error</a></span>, <span class='object_link'><a href="ApplicationController.html#session_user-instance_method" title="ApplicationController#session_user (method)">#session_user</a></span>, <span class='object_link'><a href="ApplicationController.html#store_fullpath_in_session-instance_method" title="ApplicationController#store_fullpath_in_session (method)">#store_fullpath_in_session</a></span>, <span class='object_link'><a href="ApplicationController.html#with_dropped_params-instance_method" title="ApplicationController#with_dropped_params (method)">#with_dropped_params</a></span></p>

  
  
  
  
  
  
  
  
  <h3 class="inherited">Methods included from <span class='object_link'><a href="NavTab.html" title="NavTab (module)">NavTab</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="NavTab.html#admin_tab%3F-instance_method" title="NavTab#admin_tab? (method)">#admin_tab?</a></span>, <span class='object_link'><a href="NavTab.html#global_link_collection-instance_method" title="NavTab#global_link_collection (method)">#global_link_collection</a></span>, <span class='object_link'><a href="NavTab.html#global_navigation_links-instance_method" title="NavTab#global_navigation_links (method)">#global_navigation_links</a></span>, <span class='object_link'><a href="NavTab.html#link_collection-instance_method" title="NavTab#link_collection (method)">#link_collection</a></span>, <span class='object_link'><a href="NavTab.html#navigation_links-instance_method" title="NavTab#navigation_links (method)">#navigation_links</a></span></p>

  
  
  
  
  
  
  
  
  
  <h3 class="inherited">Methods included from <span class='object_link'><a href="DateHelper.html" title="DateHelper (module)">DateHelper</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="DateHelper.html#format_usa_date-instance_method" title="DateHelper#format_usa_date (method)">#format_usa_date</a></span>, <span class='object_link'><a href="DateHelper.html#format_usa_datetime-instance_method" title="DateHelper#format_usa_datetime (method)">#format_usa_datetime</a></span>, <span class='object_link'><a href="DateHelper.html#hour_options-instance_method" title="DateHelper#hour_options (method)">#hour_options</a></span>, <span class='object_link'><a href="DateHelper.html#human_date-instance_method" title="DateHelper#human_date (method)">#human_date</a></span>, <span class='object_link'><a href="DateHelper.html#human_time-instance_method" title="DateHelper#human_time (method)">#human_time</a></span>, <span class='object_link'><a href="DateHelper.html#join_time_select_values-instance_method" title="DateHelper#join_time_select_values (method)">#join_time_select_values</a></span>, <span class='object_link'><a href="DateHelper.html#minute_options-instance_method" title="DateHelper#minute_options (method)">#minute_options</a></span>, <span class='object_link'><a href="DateHelper.html#parse_mmddyyyy_in_current_zone!-instance_method" title="DateHelper#parse_mmddyyyy_in_current_zone! (method)">#parse_mmddyyyy_in_current_zone!</a></span>, <span class='object_link'><a href="DateHelper.html#parse_usa_date-instance_method" title="DateHelper#parse_usa_date (method)">#parse_usa_date</a></span>, <span class='object_link'><a href="DateHelper.html#parse_usa_import_date-instance_method" title="DateHelper#parse_usa_import_date (method)">#parse_usa_import_date</a></span>, <span class='object_link'><a href="DateHelper.html#time_ceil-instance_method" title="DateHelper#time_ceil (method)">#time_ceil</a></span>, <span class='object_link'><a href="DateHelper.html#time_floor-instance_method" title="DateHelper#time_floor (method)">#time_floor</a></span>, <span class='object_link'><a href="DateHelper.html#time_select-instance_method" title="DateHelper#time_select (method)">#time_select</a></span>, <span class='object_link'><a href="DateHelper.html#time_select24-instance_method" title="DateHelper#time_select24 (method)">#time_select24</a></span>, <span class='object_link'><a href="DateHelper.html#time_select_tag-instance_method" title="DateHelper#time_select_tag (method)">#time_select_tag</a></span>, <span class='object_link'><a href="DateHelper.html#usa_formatted_date%3F-instance_method" title="DateHelper#usa_formatted_date? (method)">#usa_formatted_date?</a></span></p>

  <div id="constructor_details" class="method_details_list">
  <h2>Constructor Details</h2>
  
    <div class="method_details first">
  <h3 class="signature first" id="initialize-instance_method">
  
    #<strong>initialize</strong>  &#x21d2; <tt><span class='object_link'><a href="" title="ReservationsController (class)">ReservationsController</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns a new instance of ReservationsController</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


15
16
17
18</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/reservations_controller.rb', line 15</span>

<span class='kw'>def</span> <span class='id identifier rubyid_initialize'>initialize</span>
  <span class='kw'>super</span>
  <span class='ivar'>@active_tab</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>reservations</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
  
</div>


  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="ability_resource-instance_method">
  
    #<strong>ability_resource</strong>  &#x21d2; <tt>Object</tt>  <span class="extras">(private)</span>
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


327
328
329
330
331
332
333</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/reservations_controller.rb', line 327</span>

<span class='kw'>def</span> <span class='id identifier rubyid_ability_resource'>ability_resource</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_action_name'>action_name</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>index</span><span class='tstring_end'>&quot;</span></span>
    <span class='id identifier rubyid_current_facility'>current_facility</span>
  <span class='kw'>else</span>
    <span class='ivar'>@reservation</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="changes_valid_for_update?-instance_method">
  
    #<strong>changes_valid_for_update?</strong>  &#x21d2; <tt>Boolean</tt>  <span class="extras">(private)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    

  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


416
417
418</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/reservations_controller.rb', line 416</span>

<span class='kw'>def</span> <span class='id identifier rubyid_changes_valid_for_update?'>changes_valid_for_update?</span>
  <span class='id identifier rubyid_duration_change_valid?'>duration_change_valid?</span> <span class='op'>&amp;&amp;</span> <span class='const'><span class='object_link'><a href="NotePresenceValidator.html" title="NotePresenceValidator (class)">NotePresenceValidator</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="NotePresenceValidator.html#initialize-instance_method" title="NotePresenceValidator#initialize (method)">new</a></span></span><span class='lparen'>(</span><span class='ivar'>@reservation</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_valid?'><span class='object_link'><a href="NotePresenceValidator.html#valid%3F-instance_method" title="NotePresenceValidator#valid? (method)">valid?</a></span></span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="create-instance_method">
  
    #<strong>create</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>POST /orders/:order_id/order_details/:order_detail_id/reservations</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Raises:</p>
<ul class="raise">
  
    <li>
      
      
        <span class='type'>(<tt>ActiveRecord::RecordNotFound</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/reservations_controller.rb', line 95</span>

<span class='kw'>def</span> <span class='id identifier rubyid_create'>create</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'><span class='object_link'><a href="ActiveRecord.html" title="ActiveRecord (module)">ActiveRecord</a></span></span><span class='op'>::</span><span class='const'>RecordNotFound</span> <span class='kw'>unless</span> <span class='ivar'>@reservation</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>

  <span class='id identifier rubyid_creator'>creator</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="ReservationCreator.html" title="ReservationCreator (class)">ReservationCreator</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="ReservationCreator.html#initialize-instance_method" title="ReservationCreator#initialize (method)">new</a></span></span><span class='lparen'>(</span><span class='ivar'>@order</span><span class='comma'>,</span> <span class='ivar'>@order_detail</span><span class='comma'>,</span> <span class='id identifier rubyid_params'>params</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_creator'>creator</span><span class='period'>.</span><span class='id identifier rubyid_save'>save</span><span class='lparen'>(</span><span class='id identifier rubyid_session_user'>session_user</span><span class='rparen'>)</span>
    <span class='ivar'>@reservation</span> <span class='op'>=</span> <span class='id identifier rubyid_creator'>creator</span><span class='period'>.</span><span class='id identifier rubyid_reservation'>reservation</span>
    <span class='id identifier rubyid_authorize!'>authorize!</span> <span class='symbol'>:create</span><span class='comma'>,</span> <span class='ivar'>@reservation</span>
    <span class='id identifier rubyid_flash'>flash</span><span class='lbracket'>[</span><span class='symbol'>:notice</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='const'>I18n</span><span class='period'>.</span><span class='id identifier rubyid_t'>t</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>controllers.reservations.create.success</span><span class='tstring_end'>&quot;</span></span>
    <span class='id identifier rubyid_flash'>flash</span><span class='lbracket'>[</span><span class='symbol'>:error</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='const'>I18n</span><span class='period'>.</span><span class='id identifier rubyid_t'>t</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>controllers.reservations.create.admin_hold_warning</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='id identifier rubyid_creator'>creator</span><span class='period'>.</span><span class='id identifier rubyid_reservation'>reservation</span><span class='period'>.</span><span class='id identifier rubyid_conflicting_admin_reservation?'>conflicting_admin_reservation?</span>

    <span class='kw'>if</span> <span class='id identifier rubyid_creator'>creator</span><span class='period'>.</span><span class='id identifier rubyid_merged_order?'>merged_order?</span>
      <span class='id identifier rubyid_redirect_to'>redirect_to</span> <span class='id identifier rubyid_facility_order_path'>facility_order_path</span><span class='lparen'>(</span><span class='ivar'>@order_detail</span><span class='period'>.</span><span class='id identifier rubyid_facility'>facility</span><span class='comma'>,</span> <span class='ivar'>@order_detail</span><span class='period'>.</span><span class='id identifier rubyid_order'>order</span><span class='period'>.</span><span class='id identifier rubyid_merge_order'>merge_order</span> <span class='op'>||</span> <span class='ivar'>@order_detail</span><span class='period'>.</span><span class='id identifier rubyid_order'>order</span><span class='rparen'>)</span>
    <span class='kw'>elsif</span> <span class='id identifier rubyid_creator'>creator</span><span class='period'>.</span><span class='id identifier rubyid_instrument_only_order?'>instrument_only_order?</span>
      <span class='id identifier rubyid_redirect_params'>redirect_params</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span>
      <span class='id identifier rubyid_redirect_params'>redirect_params</span><span class='lbracket'>[</span><span class='symbol'>:send_notification</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>1</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:send_notification</span><span class='rbracket'>]</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>1</span><span class='tstring_end'>&quot;</span></span>
      <span class='comment'># only trigger purchase if instrument
</span>      <span class='comment'># and is only thing in cart (isn&#39;t bundled or on a multi-add order)
</span>      <span class='id identifier rubyid_redirect_to'>redirect_to</span> <span class='id identifier rubyid_purchase_order_path'>purchase_order_path</span><span class='lparen'>(</span><span class='ivar'>@order</span><span class='comma'>,</span> <span class='id identifier rubyid_redirect_params'>redirect_params</span><span class='rparen'>)</span>
    <span class='kw'>else</span>
      <span class='id identifier rubyid_redirect_to'>redirect_to</span> <span class='id identifier rubyid_cart_path'>cart_path</span>
    <span class='kw'>end</span>
  <span class='kw'>else</span>
    <span class='ivar'>@reservation</span> <span class='op'>=</span> <span class='id identifier rubyid_creator'>creator</span><span class='period'>.</span><span class='id identifier rubyid_reservation'>reservation</span>
    <span class='id identifier rubyid_flash'>flash</span><span class='period'>.</span><span class='id identifier rubyid_now'>now</span><span class='lbracket'>[</span><span class='symbol'>:error</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_creator'>creator</span><span class='period'>.</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_html_safe'>html_safe</span>
    <span class='id identifier rubyid_set_windows'>set_windows</span>
    <span class='id identifier rubyid_render'>render</span> <span class='symbol'>:new</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="default_reservation-instance_method">
  
    #<strong>default_reservation</strong>  &#x21d2; <tt>Object</tt>  <span class="extras">(private)</span>
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


399
400
401
402
403</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/reservations_controller.rb', line 399</span>

<span class='kw'>def</span> <span class='id identifier rubyid_default_reservation'>default_reservation</span>
  <span class='const'><span class='object_link'><a href="Reservation.html" title="Reservation (class)">Reservation</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='label'>product:</span> <span class='ivar'>@instrument</span><span class='comma'>,</span>
                  <span class='label'>reserve_start_at:</span> <span class='const'>Time</span><span class='period'>.</span><span class='id identifier rubyid_zone'>zone</span><span class='period'>.</span><span class='id identifier rubyid_now'>now</span><span class='comma'>,</span>
                  <span class='label'>reserve_end_at:</span> <span class='id identifier rubyid_default_reservation_mins'>default_reservation_mins</span><span class='period'>.</span><span class='id identifier rubyid_minutes'>minutes</span><span class='period'>.</span><span class='id identifier rubyid_from_now'>from_now</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="default_reservation_mins-instance_method">
  
    #<strong>default_reservation_mins</strong>  &#x21d2; <tt>Object</tt>  <span class="extras">(private)</span>
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


395
396
397</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/reservations_controller.rb', line 395</span>

<span class='kw'>def</span> <span class='id identifier rubyid_default_reservation_mins'>default_reservation_mins</span>
  <span class='ivar'>@instrument</span><span class='period'>.</span><span class='id identifier rubyid_min_reserve_mins'>min_reserve_mins</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span> <span class='op'>&gt;</span> <span class='int'>0</span> <span class='op'>?</span> <span class='ivar'>@instrument</span><span class='period'>.</span><span class='id identifier rubyid_min_reserve_mins'>min_reserve_mins</span> <span class='op'>:</span> <span class='int'>30</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="duration_change_valid?-instance_method">
  
    #<strong>duration_change_valid?</strong>  &#x21d2; <tt>Boolean</tt>  <span class="extras">(private)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    

  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


420
421
422
423</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/reservations_controller.rb', line 420</span>

<span class='kw'>def</span> <span class='id identifier rubyid_duration_change_valid?'>duration_change_valid?</span>
  <span class='id identifier rubyid_validator'>validator</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Reservations.html" title="Reservations (module)">Reservations</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Reservations/DurationChangeValidations.html" title="Reservations::DurationChangeValidations (class)">DurationChangeValidations</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="Reservations/DurationChangeValidations.html#initialize-instance_method" title="Reservations::DurationChangeValidations#initialize (method)">new</a></span></span><span class='lparen'>(</span><span class='ivar'>@reservation</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_validator'>validator</span><span class='period'>.</span><span class='id identifier rubyid_valid?'>valid?</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="earliest_move_possible-instance_method">
  
    #<strong>earliest_move_possible</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>GET
/orders/:order_id/order_details/:order_detail_id/reservations/:reservation_id/move</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


217
218
219
220
221
222
223
224
225
226
227
228
229
230
231</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/reservations_controller.rb', line 217</span>

<span class='kw'>def</span> <span class='id identifier rubyid_earliest_move_possible'>earliest_move_possible</span>
  <span class='ivar'>@reservation</span>       <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Reservation.html" title="Reservation (class)">Reservation</a></span></span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:reservation_id</span><span class='rbracket'>]</span><span class='rparen'>)</span>
  <span class='ivar'>@earliest_possible</span> <span class='op'>=</span> <span class='ivar'>@reservation</span><span class='period'>.</span><span class='id identifier rubyid_earliest_possible'>earliest_possible</span>

  <span class='kw'>if</span> <span class='ivar'>@earliest_possible</span>
    <span class='ivar'>@formatted_dates</span> <span class='op'>=</span> <span class='lbrace'>{</span>
      <span class='label'>start_date:</span> <span class='id identifier rubyid_human_date'>human_date</span><span class='lparen'>(</span><span class='ivar'>@earliest_possible</span><span class='period'>.</span><span class='id identifier rubyid_reserve_start_at'>reserve_start_at</span><span class='rparen'>)</span><span class='comma'>,</span>
      <span class='label'>start_time:</span> <span class='id identifier rubyid_human_time'>human_time</span><span class='lparen'>(</span><span class='ivar'>@earliest_possible</span><span class='period'>.</span><span class='id identifier rubyid_reserve_start_at'>reserve_start_at</span><span class='rparen'>)</span><span class='comma'>,</span>
      <span class='label'>end_date:</span> <span class='id identifier rubyid_human_date'>human_date</span><span class='lparen'>(</span><span class='ivar'>@earliest_possible</span><span class='period'>.</span><span class='id identifier rubyid_reserve_end_at'>reserve_end_at</span><span class='rparen'>)</span><span class='comma'>,</span>
      <span class='label'>end_time:</span> <span class='id identifier rubyid_human_time'>human_time</span><span class='lparen'>(</span><span class='ivar'>@earliest_possible</span><span class='period'>.</span><span class='id identifier rubyid_reserve_end_at'>reserve_end_at</span><span class='rparen'>)</span><span class='comma'>,</span>
    <span class='rbrace'>}</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_render'>render</span> <span class='label'>layout:</span> <span class='kw'>false</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="edit-instance_method">
  
    #<strong>edit</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>GET /orders/1/order_details/1/reservations/1/edit</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


164
165
166
167</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/reservations_controller.rb', line 164</span>

<span class='kw'>def</span> <span class='id identifier rubyid_edit'>edit</span>
  <span class='id identifier rubyid_redirect_to'>redirect_to</span> <span class='lbracket'>[</span><span class='ivar'>@order</span><span class='comma'>,</span> <span class='ivar'>@order_detail</span><span class='comma'>,</span> <span class='ivar'>@reservation</span><span class='rbracket'>]</span> <span class='kw'>if</span> <span class='id identifier rubyid_invalid_for_update?'>invalid_for_update?</span>
  <span class='id identifier rubyid_set_windows'>set_windows</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="editable_by_current_user?-instance_method">
  
    #<strong>editable_by_current_user?</strong>  &#x21d2; <tt>Boolean</tt>  <span class="extras">(private)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    

  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


342
343
344
345
346
347
348
349
350</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/reservations_controller.rb', line 342</span>

<span class='kw'>def</span> <span class='id identifier rubyid_editable_by_current_user?'>editable_by_current_user?</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_current_ability'>current_ability</span><span class='period'>.</span><span class='id identifier rubyid_can?'>can?</span><span class='lparen'>(</span><span class='symbol'>:manage</span><span class='comma'>,</span> <span class='ivar'>@reservation</span><span class='rparen'>)</span> <span class='op'>&amp;&amp;</span> <span class='ivar'>@reservation</span><span class='period'>.</span><span class='id identifier rubyid_admin_editable?'>admin_editable?</span>
    <span class='kw'>true</span>
  <span class='kw'>elsif</span> <span class='ivar'>@reservation</span><span class='period'>.</span><span class='id identifier rubyid_can_customer_edit?'>can_customer_edit?</span>
    <span class='kw'>true</span>
  <span class='kw'>else</span>
    <span class='kw'>false</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="fixed_start_time?-instance_method">
  
    #<strong>fixed_start_time?</strong>  &#x21d2; <tt>Boolean</tt>  <span class="extras">(private)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    

  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


278
279
280</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/reservations_controller.rb', line 278</span>

<span class='kw'>def</span> <span class='id identifier rubyid_fixed_start_time?'>fixed_start_time?</span>
  <span class='op'>!</span><span class='ivar'>@reservation</span><span class='period'>.</span><span class='id identifier rubyid_admin_editable?'>admin_editable?</span> <span class='op'>||</span> <span class='op'>!</span><span class='ivar'>@reservation</span><span class='period'>.</span><span class='id identifier rubyid_reserve_start_at_editable?'>reserve_start_at_editable?</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="helpers-instance_method">
  
    #<strong>helpers</strong>  &#x21d2; <tt>Object</tt>  <span class="extras">(private)</span>
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


391
392
393</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/reservations_controller.rb', line 391</span>

<span class='kw'>def</span> <span class='id identifier rubyid_helpers'>helpers</span>
  <span class='const'>ActionController</span><span class='op'>::</span><span class='const'>Base</span><span class='period'>.</span><span class='id identifier rubyid_helpers'>helpers</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="index-instance_method">
  
    #<strong>index</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>GET
/facilities/1/instruments/1/reservations.js?_=1279579838269&amp;start=1279429200&amp;end=1280034000</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/reservations_controller.rb', line 26</span>

<span class='kw'>def</span> <span class='id identifier rubyid_index'>index</span>
  <span class='ivar'>@facility</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Facility.html" title="Facility (class)">Facility</a></span></span><span class='period'>.</span><span class='id identifier rubyid_find_by!'>find_by!</span><span class='lparen'>(</span><span class='label'>url_name:</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:facility_id</span><span class='rbracket'>]</span><span class='rparen'>)</span>
  <span class='ivar'>@instrument</span> <span class='op'>=</span> <span class='ivar'>@facility</span><span class='period'>.</span><span class='id identifier rubyid_instruments'>instruments</span><span class='period'>.</span><span class='id identifier rubyid_find_by!'>find_by!</span><span class='lparen'>(</span><span class='label'>url_name:</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:instrument_id</span><span class='rbracket'>]</span><span class='rparen'>)</span>

  <span class='ivar'>@start_at</span> <span class='op'>=</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:start</span><span class='rbracket'>]</span> <span class='op'>?</span> <span class='const'>Time</span><span class='period'>.</span><span class='id identifier rubyid_zone'>zone</span><span class='period'>.</span><span class='id identifier rubyid_at'>at</span><span class='lparen'>(</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:start</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span><span class='rparen'>)</span> <span class='op'>:</span> <span class='const'>Time</span><span class='period'>.</span><span class='id identifier rubyid_zone'>zone</span><span class='period'>.</span><span class='id identifier rubyid_now'>now</span>
  <span class='ivar'>@end_at</span> <span class='op'>=</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:end</span><span class='rbracket'>]</span> <span class='op'>?</span> <span class='const'>Time</span><span class='period'>.</span><span class='id identifier rubyid_zone'>zone</span><span class='period'>.</span><span class='id identifier rubyid_at'>at</span><span class='lparen'>(</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:end</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span><span class='rparen'>)</span> <span class='op'>:</span> <span class='ivar'>@start_at</span><span class='period'>.</span><span class='id identifier rubyid_end_of_day'>end_of_day</span>

  <span class='id identifier rubyid_admin_reservations'>admin_reservations</span> <span class='op'>=</span> <span class='ivar'>@instrument</span><span class='period'>.</span><span class='id identifier rubyid_schedule'>schedule</span><span class='period'>.</span><span class='id identifier rubyid_admin_reservations'>admin_reservations</span><span class='period'>.</span><span class='id identifier rubyid_in_range'>in_range</span><span class='lparen'>(</span><span class='ivar'>@start_at</span><span class='comma'>,</span> <span class='ivar'>@end_at</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_user_reservations'>user_reservations</span> <span class='op'>=</span> <span class='ivar'>@instrument</span><span class='period'>.</span><span class='id identifier rubyid_schedule'>schedule</span>
                                 <span class='period'>.</span><span class='id identifier rubyid_reservations'>reservations</span>
                                 <span class='period'>.</span><span class='id identifier rubyid_active'>active</span>
                                 <span class='period'>.</span><span class='id identifier rubyid_in_range'>in_range</span><span class='lparen'>(</span><span class='ivar'>@start_at</span><span class='comma'>,</span> <span class='ivar'>@end_at</span><span class='rparen'>)</span>
                                 <span class='period'>.</span><span class='id identifier rubyid_includes'>includes</span><span class='lparen'>(</span><span class='label'>order_detail:</span> <span class='lbrace'>{</span> <span class='label'>order:</span> <span class='symbol'>:user</span> <span class='rbrace'>}</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_offline_reservations'>offline_reservations</span> <span class='op'>=</span> <span class='ivar'>@instrument</span><span class='period'>.</span><span class='id identifier rubyid_offline_reservations'>offline_reservations</span><span class='period'>.</span><span class='id identifier rubyid_in_range'>in_range</span><span class='lparen'>(</span><span class='ivar'>@start_at</span><span class='comma'>,</span> <span class='ivar'>@end_at</span><span class='rparen'>)</span>

  <span class='ivar'>@reservations</span> <span class='op'>=</span> <span class='id identifier rubyid_admin_reservations'>admin_reservations</span> <span class='op'>+</span> <span class='id identifier rubyid_user_reservations'>user_reservations</span> <span class='op'>+</span> <span class='id identifier rubyid_offline_reservations'>offline_reservations</span>

  <span class='comment'># We don&#39;t need the unavailable hours month view
</span>  <span class='kw'>unless</span> <span class='id identifier rubyid_month_view?'>month_view?</span>
    <span class='ivar'>@rules</span> <span class='op'>=</span> <span class='ivar'>@instrument</span><span class='period'>.</span><span class='id identifier rubyid_schedule_rules'>schedule_rules</span>

    <span class='kw'>if</span> <span class='ivar'>@instrument</span><span class='period'>.</span><span class='id identifier rubyid_requires_approval?'>requires_approval?</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_acting_user'>acting_user</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_acting_user'>acting_user</span><span class='period'>.</span><span class='id identifier rubyid_cannot_override_restrictions?'>cannot_override_restrictions?</span><span class='lparen'>(</span><span class='ivar'>@instrument</span><span class='rparen'>)</span>
      <span class='ivar'>@rules</span> <span class='op'>=</span> <span class='ivar'>@rules</span><span class='period'>.</span><span class='id identifier rubyid_available_to_user'>available_to_user</span><span class='lparen'>(</span><span class='id identifier rubyid_acting_user'>acting_user</span><span class='rparen'>)</span>
    <span class='kw'>end</span>

    <span class='ivar'>@unavailable</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="ScheduleRule.html" title="ScheduleRule (class)">ScheduleRule</a></span></span><span class='period'>.</span><span class='id identifier rubyid_unavailable'><span class='object_link'><a href="ScheduleRule.html#unavailable-class_method" title="ScheduleRule.unavailable (method)">unavailable</a></span></span><span class='lparen'>(</span><span class='ivar'>@rules</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='ivar'>@show_details</span> <span class='op'>=</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:with_details</span><span class='rbracket'>]</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>true</span><span class='tstring_end'>&quot;</span></span> <span class='op'>&amp;&amp;</span> <span class='lparen'>(</span><span class='ivar'>@instrument</span><span class='period'>.</span><span class='id identifier rubyid_show_details?'>show_details?</span> <span class='op'>||</span> <span class='id identifier rubyid_can?'>can?</span><span class='lparen'>(</span><span class='symbol'>:administer</span><span class='comma'>,</span> <span class='const'><span class='object_link'><a href="Reservation.html" title="Reservation (class)">Reservation</a></span></span><span class='rparen'>)</span><span class='rparen'>)</span>

  <span class='id identifier rubyid_respond_to'>respond_to</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_format'>format</span><span class='op'>|</span>
    <span class='id identifier rubyid_as_calendar_object_options'>as_calendar_object_options</span> <span class='op'>=</span> <span class='lbrace'>{</span> <span class='label'>start_date:</span> <span class='ivar'>@start_at</span><span class='period'>.</span><span class='id identifier rubyid_beginning_of_day'>beginning_of_day</span><span class='comma'>,</span> <span class='label'>with_details:</span> <span class='ivar'>@show_details</span> <span class='rbrace'>}</span>
    <span class='id identifier rubyid_format'>format</span><span class='period'>.</span><span class='id identifier rubyid_js'>js</span> <span class='kw'>do</span>
      <span class='id identifier rubyid_render'>render</span> <span class='label'>json:</span> <span class='const'><span class='object_link'><a href="Reservation.html" title="Reservation (class)">Reservation</a></span></span><span class='period'>.</span><span class='id identifier rubyid_as_calendar_objects'>as_calendar_objects</span><span class='lparen'>(</span><span class='ivar'>@reservations</span><span class='comma'>,</span> <span class='id identifier rubyid_as_calendar_object_options'>as_calendar_object_options</span><span class='rparen'>)</span> <span class='op'>+</span>
                   <span class='const'><span class='object_link'><a href="ScheduleRule.html" title="ScheduleRule (class)">ScheduleRule</a></span></span><span class='period'>.</span><span class='id identifier rubyid_as_calendar_objects'><span class='object_link'><a href="ScheduleRule.html#as_calendar_objects-class_method" title="ScheduleRule.as_calendar_objects (method)">as_calendar_objects</a></span></span><span class='lparen'>(</span><span class='ivar'>@unavailable</span><span class='comma'>,</span> <span class='id identifier rubyid_as_calendar_object_options'>as_calendar_object_options</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="invalid_for_update?-instance_method">
  
    #<strong>invalid_for_update?</strong>  &#x21d2; <tt>Boolean</tt>  <span class="extras">(private)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>TODO: you shouldn&#39;t be able to edit reservations that have passed or
are outside of the cancellation period (check to make sure order has been
placed)</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


336
337
338
339
340</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/reservations_controller.rb', line 336</span>

<span class='kw'>def</span> <span class='id identifier rubyid_invalid_for_update?'>invalid_for_update?</span>
  <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:id</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span> <span class='op'>!=</span> <span class='ivar'>@reservation</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span> <span class='op'>||</span>
    <span class='ivar'>@reservation</span><span class='period'>.</span><span class='id identifier rubyid_actual_end_at'>actual_end_at</span> <span class='op'>||</span>
    <span class='op'>!</span><span class='id identifier rubyid_editable_by_current_user?'>editable_by_current_user?</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="list-instance_method">
  
    #<strong>list</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>GET /reservations All My Resesrvations</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/reservations_controller.rb', line 67</span>

<span class='kw'>def</span> <span class='id identifier rubyid_list'>list</span>
  <span class='id identifier rubyid_notices'>notices</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>

  <span class='id identifier rubyid_relation'>relation</span> <span class='op'>=</span> <span class='id identifier rubyid_acting_user'>acting_user</span><span class='period'>.</span><span class='id identifier rubyid_order_details'>order_details</span>
  <span class='id identifier rubyid_in_progress'>in_progress</span> <span class='op'>=</span> <span class='id identifier rubyid_relation'>relation</span><span class='period'>.</span><span class='id identifier rubyid_in_progress_reservations'>in_progress_reservations</span>
  <span class='ivar'>@status</span> <span class='op'>=</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:status</span><span class='rbracket'>]</span>
  <span class='ivar'>@available_statuses</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='id identifier rubyid_in_progress'>in_progress</span><span class='period'>.</span><span class='id identifier rubyid_blank?'>blank?</span> <span class='op'>?</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>upcoming</span><span class='tstring_end'>&quot;</span></span> <span class='op'>:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>upcoming_and_in_progress</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>all</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span>

  <span class='kw'>if</span> <span class='ivar'>@status</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>all</span><span class='tstring_end'>&quot;</span></span>
    <span class='ivar'>@order_details</span> <span class='op'>=</span> <span class='id identifier rubyid_relation'>relation</span><span class='period'>.</span><span class='id identifier rubyid_all_reservations'>all_reservations</span>
  <span class='kw'>elsif</span> <span class='ivar'>@status</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>upcoming</span><span class='tstring_end'>&quot;</span></span>
    <span class='ivar'>@status</span> <span class='op'>=</span> <span class='ivar'>@available_statuses</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span>
    <span class='ivar'>@order_details</span> <span class='op'>=</span> <span class='id identifier rubyid_in_progress'>in_progress</span> <span class='op'>+</span> <span class='id identifier rubyid_relation'>relation</span><span class='period'>.</span><span class='id identifier rubyid_upcoming_reservations'>upcoming_reservations</span>
  <span class='kw'>else</span>
    <span class='kw'>return</span> <span class='id identifier rubyid_redirect_to'>redirect_to</span> <span class='id identifier rubyid_reservations_status_path'>reservations_status_path</span><span class='lparen'>(</span><span class='label'>status:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>upcoming</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='ivar'>@order_details</span> <span class='op'>=</span> <span class='ivar'>@order_details</span><span class='period'>.</span><span class='id identifier rubyid_paginate'>paginate</span><span class='lparen'>(</span><span class='label'>page:</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:page</span><span class='rbracket'>]</span><span class='rparen'>)</span>

  <span class='id identifier rubyid_notices'>notices</span> <span class='op'>=</span> <span class='ivar'>@order_details</span><span class='period'>.</span><span class='id identifier rubyid_collect'>collect</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_od'>od</span><span class='op'>|</span>
    <span class='id identifier rubyid_notice_for_reservation'>notice_for_reservation</span> <span class='id identifier rubyid_od'>od</span><span class='period'>.</span><span class='id identifier rubyid_reservation'>reservation</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_notices'>notices</span><span class='period'>.</span><span class='id identifier rubyid_compact!'>compact!</span>
  <span class='id identifier rubyid_existing_notices'>existing_notices</span> <span class='op'>=</span> <span class='id identifier rubyid_flash'>flash</span><span class='lbracket'>[</span><span class='symbol'>:notice</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_presence'>presence</span> <span class='op'>?</span> <span class='lbracket'>[</span><span class='id identifier rubyid_flash'>flash</span><span class='lbracket'>[</span><span class='symbol'>:notice</span><span class='rbracket'>]</span><span class='rbracket'>]</span> <span class='op'>:</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_flash'>flash</span><span class='period'>.</span><span class='id identifier rubyid_now'>now</span><span class='lbracket'>[</span><span class='symbol'>:notice</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_existing_notices'>existing_notices</span><span class='period'>.</span><span class='id identifier rubyid_concat'>concat</span><span class='lparen'>(</span><span class='id identifier rubyid_notices'>notices</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>&lt;br /&gt;</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_html_safe'>html_safe</span> <span class='kw'>unless</span> <span class='id identifier rubyid_notices'>notices</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="load_and_check_resources-instance_method">
  
    #<strong>load_and_check_resources</strong>  &#x21d2; <tt>Object</tt>  <span class="extras">(private)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    

  </div>
</div>
<div class="tags">
  
<p class="tag_title">Raises:</p>
<ul class="raise">
  
    <li>
      
      
        <span class='type'>(<tt>ActiveRecord::RecordNotFound</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


322
323
324
325</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/reservations_controller.rb', line 322</span>

<span class='kw'>def</span> <span class='id identifier rubyid_load_and_check_resources'>load_and_check_resources</span>
  <span class='id identifier rubyid_load_basic_resources'>load_basic_resources</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'><span class='object_link'><a href="ActiveRecord.html" title="ActiveRecord (module)">ActiveRecord</a></span></span><span class='op'>::</span><span class='const'>RecordNotFound</span> <span class='kw'>if</span> <span class='ivar'>@reservation</span><span class='period'>.</span><span class='id identifier rubyid_blank?'>blank?</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="load_basic_resources-instance_method">
  
    #<strong>load_basic_resources</strong>  &#x21d2; <tt>Object</tt>  <span class="extras">(private)</span>
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


305
306
307
308
309
310
311
312
313
314
315
316
317
318
319
320</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/reservations_controller.rb', line 305</span>

<span class='kw'>def</span> <span class='id identifier rubyid_load_basic_resources'>load_basic_resources</span>
  <span class='ivar'>@order</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Order.html" title="Order (class)">Order</a></span></span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:order_id</span><span class='rbracket'>]</span><span class='rparen'>)</span>
  <span class='comment'># It&#39;s important that the order_detail be the same object as the one in @order.order_details.first
</span>  <span class='ivar'>@order_detail</span> <span class='op'>=</span> <span class='ivar'>@order</span><span class='period'>.</span><span class='id identifier rubyid_order_details'>order_details</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_od'>od</span><span class='op'>|</span> <span class='id identifier rubyid_od'>od</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span> <span class='op'>==</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:order_detail_id</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span> <span class='rbrace'>}</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'><span class='object_link'><a href="ActiveRecord.html" title="ActiveRecord (module)">ActiveRecord</a></span></span><span class='op'>::</span><span class='const'>RecordNotFound</span> <span class='kw'>if</span> <span class='ivar'>@order_detail</span><span class='period'>.</span><span class='id identifier rubyid_blank?'>blank?</span>
  <span class='ivar'>@reservation</span> <span class='op'>=</span> <span class='ivar'>@order_detail</span><span class='period'>.</span><span class='id identifier rubyid_reservation'>reservation</span>
  <span class='ivar'>@instrument</span> <span class='op'>=</span> <span class='ivar'>@order_detail</span><span class='period'>.</span><span class='id identifier rubyid_product'>product</span>
  <span class='ivar'>@facility</span> <span class='op'>=</span> <span class='ivar'>@instrument</span><span class='period'>.</span><span class='id identifier rubyid_facility'>facility</span>
<span class='kw'>rescue</span> <span class='const'><span class='object_link'><a href="ActiveRecord.html" title="ActiveRecord (module)">ActiveRecord</a></span></span><span class='op'>::</span><span class='const'>RecordNotFound</span>
  <span class='id identifier rubyid_flash'>flash</span><span class='lbracket'>[</span><span class='symbol'>:error</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_text'>text</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>order_detail_removed</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='ivar'>@order</span>
    <span class='id identifier rubyid_redirect_to'>redirect_to</span> <span class='id identifier rubyid_facility_path'>facility_path</span><span class='lparen'>(</span><span class='ivar'>@order</span><span class='period'>.</span><span class='id identifier rubyid_facility'>facility</span><span class='rparen'>)</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_raise'>raise</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="max_reservation_window-instance_method">
  
    #<strong>max_reservation_window</strong>  &#x21d2; <tt>Object</tt>  <span class="extras">(private)</span>
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


366
367
368
369</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/reservations_controller.rb', line 366</span>

<span class='kw'>def</span> <span class='id identifier rubyid_max_reservation_window'>max_reservation_window</span>
  <span class='kw'>return</span> <span class='int'>365</span> <span class='kw'>if</span> <span class='id identifier rubyid_session_user'>session_user</span><span class='period'>.</span><span class='id identifier rubyid_operator_of?'>operator_of?</span><span class='lparen'>(</span><span class='ivar'>@facility</span><span class='rparen'>)</span>
  <span class='ivar'>@reservation</span><span class='period'>.</span><span class='id identifier rubyid_longest_reservation_window'>longest_reservation_window</span><span class='lparen'>(</span><span class='ivar'>@order_detail</span><span class='period'>.</span><span class='id identifier rubyid_price_groups'>price_groups</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="month_view?-instance_method">
  
    #<strong>month_view?</strong>  &#x21d2; <tt>Boolean</tt>  <span class="extras">(private)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>`1.week` causes a problem with daylight saving week since it&#39;s
technically longer than a week</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


407
408
409</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/reservations_controller.rb', line 407</span>

<span class='kw'>def</span> <span class='id identifier rubyid_month_view?'>month_view?</span>
  <span class='ivar'>@end_at</span> <span class='op'>-</span> <span class='ivar'>@start_at</span> <span class='op'>&gt;</span> <span class='int'>8</span><span class='period'>.</span><span class='id identifier rubyid_days'>days</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="move-instance_method">
  
    #<strong>move</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>POST
/orders/:order_id/order_details/:order_detail_id/reservations/:reservation_id/move</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


206
207
208
209
210
211
212
213
214</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/reservations_controller.rb', line 206</span>

<span class='kw'>def</span> <span class='id identifier rubyid_move'>move</span>
  <span class='kw'>if</span> <span class='ivar'>@reservation</span><span class='period'>.</span><span class='id identifier rubyid_move_to_earliest'>move_to_earliest</span>
    <span class='id identifier rubyid_flash'>flash</span><span class='lbracket'>[</span><span class='symbol'>:notice</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>The reservation was moved successfully.</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_flash'>flash</span><span class='lbracket'>[</span><span class='symbol'>:error</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='ivar'>@reservation</span><span class='period'>.</span><span class='id identifier rubyid_errors'>errors</span><span class='period'>.</span><span class='id identifier rubyid_full_messages'>full_messages</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>&lt;br/&gt;</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_html_safe'>html_safe</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_redirect_to'>redirect_to</span> <span class='id identifier rubyid_reservations_status_path'>reservations_status_path</span><span class='lparen'>(</span><span class='label'>status:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>upcoming</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="new-instance_method">
  
    #<strong>new</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>GET /orders/:order_id/order_details/:order_detail_id/reservations/new</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Raises:</p>
<ul class="raise">
  
    <li>
      
      
        <span class='type'>(<tt>ActiveRecord::RecordNotFound</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/reservations_controller.rb', line 125</span>

<span class='kw'>def</span> <span class='id identifier rubyid_new'>new</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'><span class='object_link'><a href="ActiveRecord.html" title="ActiveRecord (module)">ActiveRecord</a></span></span><span class='op'>::</span><span class='const'>RecordNotFound</span> <span class='kw'>unless</span> <span class='ivar'>@reservation</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>

  <span class='id identifier rubyid_options'>options</span> <span class='op'>=</span> <span class='id identifier rubyid_current_user'>current_user</span><span class='period'>.</span><span class='id identifier rubyid_can_override_restrictions?'>can_override_restrictions?</span><span class='lparen'>(</span><span class='ivar'>@instrument</span><span class='rparen'>)</span> <span class='op'>?</span> <span class='lbrace'>{</span><span class='rbrace'>}</span> <span class='op'>:</span> <span class='lbrace'>{</span> <span class='label'>user:</span> <span class='id identifier rubyid_acting_user'>acting_user</span> <span class='rbrace'>}</span>
  <span class='id identifier rubyid_next_available'>next_available</span> <span class='op'>=</span> <span class='ivar'>@instrument</span><span class='period'>.</span><span class='id identifier rubyid_next_available_reservation'>next_available_reservation</span><span class='lparen'>(</span><span class='label'>after:</span> <span class='int'>1</span><span class='period'>.</span><span class='id identifier rubyid_minute'>minute</span><span class='period'>.</span><span class='id identifier rubyid_from_now'>from_now</span><span class='comma'>,</span> <span class='label'>duration:</span> <span class='id identifier rubyid_default_reservation_mins'>default_reservation_mins</span><span class='period'>.</span><span class='id identifier rubyid_minutes'>minutes</span><span class='comma'>,</span> <span class='label'>options:</span> <span class='id identifier rubyid_options'>options</span><span class='rparen'>)</span>
  <span class='ivar'>@reservation</span> <span class='op'>=</span> <span class='id identifier rubyid_next_available'>next_available</span> <span class='op'>||</span> <span class='id identifier rubyid_default_reservation'>default_reservation</span>
  <span class='ivar'>@reservation</span><span class='period'>.</span><span class='id identifier rubyid_order_detail'>order_detail</span> <span class='op'>=</span> <span class='ivar'>@order_detail</span>

  <span class='id identifier rubyid_authorize!'>authorize!</span> <span class='symbol'>:new</span><span class='comma'>,</span> <span class='ivar'>@reservation</span>

  <span class='ivar'>@reservation</span><span class='period'>.</span><span class='id identifier rubyid_round_reservation_times'>round_reservation_times</span>
  <span class='kw'>unless</span> <span class='ivar'>@instrument</span><span class='period'>.</span><span class='id identifier rubyid_can_be_used_by?'>can_be_used_by?</span><span class='lparen'>(</span><span class='ivar'>@order_detail</span><span class='period'>.</span><span class='id identifier rubyid_user'>user</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_flash'>flash</span><span class='lbracket'>[</span><span class='symbol'>:notice</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_text'>text</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>.acting_as_not_on_approval_list</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_set_windows'>set_windows</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="notice_for_reservation-instance_method">
  
    #<strong>notice_for_reservation</strong>(reservation)  &#x21d2; <tt>Object</tt>  <span class="extras">(private)</span>
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


371
372
373
374
375
376
377
378
379
380
381
382
383
384</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/reservations_controller.rb', line 371</span>

<span class='kw'>def</span> <span class='id identifier rubyid_notice_for_reservation'>notice_for_reservation</span><span class='lparen'>(</span><span class='id identifier rubyid_reservation'>reservation</span><span class='rparen'>)</span>
  <span class='kw'>return</span> <span class='kw'>unless</span> <span class='id identifier rubyid_reservation'>reservation</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_reservation'>reservation</span><span class='period'>.</span><span class='id identifier rubyid_can_switch_instrument_off?'>can_switch_instrument_off?</span> <span class='comment'># do you need to click stop
</span>    <span class='const'>I18n</span><span class='period'>.</span><span class='id identifier rubyid_t'>t</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>reservations.notices.can_switch_off</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='label'>reservation:</span> <span class='id identifier rubyid_reservation'>reservation</span><span class='rparen'>)</span>
  <span class='kw'>elsif</span> <span class='id identifier rubyid_reservation'>reservation</span><span class='period'>.</span><span class='id identifier rubyid_can_switch_instrument_on?'>can_switch_instrument_on?</span> <span class='comment'># do you need to begin your reservation
</span>    <span class='const'>I18n</span><span class='period'>.</span><span class='id identifier rubyid_t'>t</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>reservations.notices.can_switch_on</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='label'>reservation:</span> <span class='id identifier rubyid_reservation'>reservation</span><span class='rparen'>)</span>
  <span class='kw'>elsif</span> <span class='id identifier rubyid_reservation'>reservation</span><span class='period'>.</span><span class='id identifier rubyid_canceled?'>canceled?</span>
  <span class='comment'># no message
</span>  <span class='comment'># do you have a reservation for today that hasn&#39;t ended
</span>  <span class='kw'>elsif</span> <span class='id identifier rubyid_upcoming_today?'>upcoming_today?</span> <span class='id identifier rubyid_reservation'>reservation</span>
    <span class='const'>I18n</span><span class='period'>.</span><span class='id identifier rubyid_t'>t</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>reservations.notices.upcoming</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='label'>reservation:</span> <span class='id identifier rubyid_reservation'>reservation</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="public_timeline-instance_method">
  
    #<strong>public_timeline</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


20
21
22
23</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/reservations_controller.rb', line 20</span>

<span class='kw'>def</span> <span class='id identifier rubyid_public_timeline'>public_timeline</span>
  <span class='ivar'>@public_timeline</span> <span class='op'>=</span> <span class='kw'>true</span>
  <span class='id identifier rubyid_timeline'>timeline</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="render_edit-instance_method">
  
    #<strong>render_edit</strong>  &#x21d2; <tt>Object</tt>  <span class="extras">(private)</span>
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


411
412
413
414</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/reservations_controller.rb', line 411</span>

<span class='kw'>def</span> <span class='id identifier rubyid_render_edit'>render_edit</span>
  <span class='id identifier rubyid_set_windows'>set_windows</span>
  <span class='id identifier rubyid_render'>render</span> <span class='label'>action:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>edit</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="reservation_params-instance_method">
  
    #<strong>reservation_params</strong>  &#x21d2; <tt>Object</tt>  <span class="extras">(private)</span>
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/reservations_controller.rb', line 260</span>

<span class='kw'>def</span> <span class='id identifier rubyid_reservation_params'>reservation_params</span>
  <span class='id identifier rubyid_reservation_params'>reservation_params</span> <span class='op'>=</span> <span class='id identifier rubyid_params'>params</span><span class='period'>.</span><span class='id identifier rubyid_require'>require</span><span class='lparen'>(</span><span class='symbol'>:reservation</span><span class='rparen'>)</span>
                             <span class='period'>.</span><span class='id identifier rubyid_except'>except</span><span class='lparen'>(</span><span class='symbol'>:reserve_end_date</span><span class='comma'>,</span> <span class='symbol'>:reserve_end_hour</span><span class='comma'>,</span> <span class='symbol'>:reserve_end_min</span><span class='comma'>,</span> <span class='symbol'>:reserve_end_meridian</span><span class='rparen'>)</span>
                             <span class='period'>.</span><span class='id identifier rubyid_permit'>permit</span><span class='lparen'>(</span><span class='symbol'>:reserve_start_date</span><span class='comma'>,</span>
                                     <span class='symbol'>:reserve_start_hour</span><span class='comma'>,</span>
                                     <span class='symbol'>:reserve_start_min</span><span class='comma'>,</span>
                                     <span class='symbol'>:reserve_start_meridian</span><span class='comma'>,</span>
                                     <span class='symbol'>:duration_mins</span><span class='comma'>,</span>
                                     <span class='symbol'>:note</span><span class='rparen'>)</span>

  <span class='comment'># Prevent overriding of start time params after purchase if start time is locked,
</span>  <span class='comment'># e.g. you are in the lock window or the reservation has already started and
</span>  <span class='comment'># you are only allowed to extend the reservation.
</span>  <span class='id identifier rubyid_reservation_params'>reservation_params</span><span class='period'>.</span><span class='id identifier rubyid_merge!'>merge!</span><span class='lparen'>(</span><span class='id identifier rubyid_reservation_start_as_params'>reservation_start_as_params</span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='id identifier rubyid_fixed_start_time?'>fixed_start_time?</span> <span class='op'>&amp;&amp;</span> <span class='op'>!</span><span class='ivar'>@reservation</span><span class='period'>.</span><span class='id identifier rubyid_in_cart?'>in_cart?</span>

  <span class='id identifier rubyid_reservation_params'>reservation_params</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="reservation_start_as_params-instance_method">
  
    #<strong>reservation_start_as_params</strong>  &#x21d2; <tt>Object</tt>  <span class="extras">(private)</span>
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


282
283
284
285
286
287
288
289</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/reservations_controller.rb', line 282</span>

<span class='kw'>def</span> <span class='id identifier rubyid_reservation_start_as_params'>reservation_start_as_params</span>
  <span class='lbrace'>{</span>
    <span class='label'>reserve_start_date:</span> <span class='ivar'>@reservation</span><span class='period'>.</span><span class='id identifier rubyid_reserve_start_date'>reserve_start_date</span><span class='comma'>,</span>
    <span class='label'>reserve_start_hour:</span> <span class='ivar'>@reservation</span><span class='period'>.</span><span class='id identifier rubyid_reserve_start_hour'>reserve_start_hour</span><span class='comma'>,</span>
    <span class='label'>reserve_start_min:</span> <span class='ivar'>@reservation</span><span class='period'>.</span><span class='id identifier rubyid_reserve_start_min'>reserve_start_min</span><span class='comma'>,</span>
    <span class='label'>reserve_start_meridian:</span> <span class='ivar'>@reservation</span><span class='period'>.</span><span class='id identifier rubyid_reserve_start_meridian'>reserve_start_meridian</span><span class='comma'>,</span>
  <span class='rbrace'>}</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="save_reservation_and_order_detail-instance_method">
  
    #<strong>save_reservation_and_order_detail</strong>  &#x21d2; <tt>Object</tt>  <span class="extras">(private)</span>
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


352
353
354
355
356</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/reservations_controller.rb', line 352</span>

<span class='kw'>def</span> <span class='id identifier rubyid_save_reservation_and_order_detail'>save_reservation_and_order_detail</span>
  <span class='ivar'>@reservation</span><span class='period'>.</span><span class='id identifier rubyid_save_as_user!'>save_as_user!</span><span class='lparen'>(</span><span class='id identifier rubyid_session_user'>session_user</span><span class='rparen'>)</span>
  <span class='ivar'>@order_detail</span><span class='period'>.</span><span class='id identifier rubyid_assign_estimated_price'>assign_estimated_price</span><span class='lparen'>(</span><span class='ivar'>@reservation</span><span class='period'>.</span><span class='id identifier rubyid_reserve_end_at'>reserve_end_at</span><span class='rparen'>)</span>
  <span class='ivar'>@order_detail</span><span class='period'>.</span><span class='id identifier rubyid_save_as_user!'>save_as_user!</span><span class='lparen'>(</span><span class='id identifier rubyid_session_user'>session_user</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="set_windows-instance_method">
  
    #<strong>set_windows</strong>  &#x21d2; <tt>Object</tt>  <span class="extras">(private)</span>
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


358
359
360
361
362
363
364</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/reservations_controller.rb', line 358</span>

<span class='kw'>def</span> <span class='id identifier rubyid_set_windows'>set_windows</span>
  <span class='ivar'>@max_window</span> <span class='op'>=</span> <span class='id identifier rubyid_max_reservation_window'>max_reservation_window</span>
  <span class='ivar'>@max_days_ago</span> <span class='op'>=</span> <span class='id identifier rubyid_session_user'>session_user</span><span class='period'>.</span><span class='id identifier rubyid_operator_of?'>operator_of?</span><span class='lparen'>(</span><span class='ivar'>@facility</span><span class='rparen'>)</span> <span class='op'>?</span> <span class='op'>-</span><span class='int'>365</span> <span class='op'>:</span> <span class='int'>0</span>
  <span class='comment'># initialize calendar time constraints
</span>  <span class='ivar'>@min_date</span>     <span class='op'>=</span> <span class='lparen'>(</span><span class='const'>Time</span><span class='period'>.</span><span class='id identifier rubyid_zone'>zone</span><span class='period'>.</span><span class='id identifier rubyid_now'>now</span> <span class='op'>+</span> <span class='ivar'>@max_days_ago</span><span class='period'>.</span><span class='id identifier rubyid_days'>days</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_strftime'>strftime</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>%Y%m%d</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
  <span class='ivar'>@max_date</span>     <span class='op'>=</span> <span class='lparen'>(</span><span class='const'>Time</span><span class='period'>.</span><span class='id identifier rubyid_zone'>zone</span><span class='period'>.</span><span class='id identifier rubyid_now'>now</span> <span class='op'>+</span> <span class='ivar'>@max_window</span><span class='period'>.</span><span class='id identifier rubyid_days'>days</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_strftime'>strftime</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>%Y%m%d</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="show-instance_method">
  
    #<strong>show</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>GET
/orders/:order_id/order_details/:order_detail_id/reservations/:id(.:format)</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Raises:</p>
<ul class="raise">
  
    <li>
      
      
        <span class='type'>(<tt>ActiveRecord::RecordNotFound</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/reservations_controller.rb', line 143</span>

<span class='kw'>def</span> <span class='id identifier rubyid_show'>show</span>
  <span class='ivar'>@order</span>        <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Order.html" title="Order (class)">Order</a></span></span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:order_id</span><span class='rbracket'>]</span><span class='rparen'>)</span>
  <span class='ivar'>@order_detail</span> <span class='op'>=</span> <span class='ivar'>@order</span><span class='period'>.</span><span class='id identifier rubyid_order_details'>order_details</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:order_detail_id</span><span class='rbracket'>]</span><span class='rparen'>)</span>
  <span class='ivar'>@reservation</span>  <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Reservation.html" title="Reservation (class)">Reservation</a></span></span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:id</span><span class='rbracket'>]</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_authorize!'>authorize!</span> <span class='symbol'>:show</span><span class='comma'>,</span> <span class='ivar'>@reservation</span>

  <span class='id identifier rubyid_raise'>raise</span> <span class='const'><span class='object_link'><a href="ActiveRecord.html" title="ActiveRecord (module)">ActiveRecord</a></span></span><span class='op'>::</span><span class='const'>RecordNotFound</span> <span class='kw'>if</span> <span class='ivar'>@reservation</span> <span class='op'>!=</span> <span class='ivar'>@order_detail</span><span class='period'>.</span><span class='id identifier rubyid_reservation'>reservation</span>

  <span class='id identifier rubyid_respond_to'>respond_to</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_format'>format</span><span class='op'>|</span>
    <span class='id identifier rubyid_format'>format</span><span class='period'>.</span><span class='id identifier rubyid_html'>html</span>

    <span class='id identifier rubyid_format'>format</span><span class='period'>.</span><span class='id identifier rubyid_ics'>ics</span> <span class='kw'>do</span>
      <span class='id identifier rubyid_calendar'>calendar</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="ReservationCalendar.html" title="ReservationCalendar (class)">ReservationCalendar</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="ReservationCalendar.html#initialize-instance_method" title="ReservationCalendar#initialize (method)">new</a></span></span><span class='lparen'>(</span><span class='ivar'>@reservation</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_send_data'>send_data</span><span class='lparen'>(</span><span class='id identifier rubyid_calendar'>calendar</span><span class='period'>.</span><span class='id identifier rubyid_to_ical'>to_ical</span><span class='comma'>,</span>
                <span class='label'>type:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>text/calendar</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='label'>disposition:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>attachment</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
                <span class='label'>filename:</span> <span class='id identifier rubyid_calendar'>calendar</span><span class='period'>.</span><span class='id identifier rubyid_filename'>filename</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="switch_instrument-instance_method">
  
    #<strong>switch_instrument</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>GET
/orders/:order_id/order_details/:order_detail_id/reservations/switch_instrument</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Raises:</p>
<ul class="raise">
  
    <li>
      
      
        <span class='type'>(<tt>ActiveRecord::RecordNotFound</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/reservations_controller.rb', line 234</span>

<span class='kw'>def</span> <span class='id identifier rubyid_switch_instrument'>switch_instrument</span>
  <span class='id identifier rubyid_authorize!'>authorize!</span> <span class='symbol'>:start_stop</span><span class='comma'>,</span> <span class='ivar'>@reservation</span>

  <span class='id identifier rubyid_raise'>raise</span> <span class='const'><span class='object_link'><a href="ActiveRecord.html" title="ActiveRecord (module)">ActiveRecord</a></span></span><span class='op'>::</span><span class='const'>RecordNotFound</span> <span class='kw'>unless</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:switch</span><span class='rbracket'>]</span> <span class='op'>&amp;&amp;</span> <span class='lparen'>(</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:switch</span><span class='rbracket'>]</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>on</span><span class='tstring_end'>&quot;</span></span> <span class='op'>||</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:switch</span><span class='rbracket'>]</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>off</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>

  <span class='kw'>begin</span>
    <span class='kw'>case</span>
    <span class='kw'>when</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:switch</span><span class='rbracket'>]</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>on</span><span class='tstring_end'>&quot;</span></span>
      <span class='id identifier rubyid_switch_instrument_on!'>switch_instrument_on!</span>
    <span class='kw'>when</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:switch</span><span class='rbracket'>]</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>off</span><span class='tstring_end'>&quot;</span></span>
      <span class='id identifier rubyid_switch_instrument_off!'>switch_instrument_off!</span>
    <span class='kw'>end</span>
  <span class='kw'>rescue</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_e'>e</span>
    <span class='id identifier rubyid_flash'>flash</span><span class='lbracket'>[</span><span class='symbol'>:error</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_e'>e</span><span class='period'>.</span><span class='id identifier rubyid_message'>message</span>
  <span class='kw'>end</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:switch</span><span class='rbracket'>]</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>off</span><span class='tstring_end'>&quot;</span></span> <span class='op'>&amp;&amp;</span> <span class='ivar'>@order_detail</span><span class='period'>.</span><span class='id identifier rubyid_accessories?'>accessories?</span>
    <span class='id identifier rubyid_redirect_to'>redirect_to</span> <span class='id identifier rubyid_new_order_order_detail_accessory_path'>new_order_order_detail_accessory_path</span><span class='lparen'>(</span><span class='ivar'>@order</span><span class='comma'>,</span> <span class='ivar'>@order_detail</span><span class='rparen'>)</span>
    <span class='kw'>return</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_redirect_to'>redirect_to</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:redirect_to</span><span class='rbracket'>]</span> <span class='op'>||</span> <span class='id identifier rubyid_request'>request</span><span class='period'>.</span><span class='id identifier rubyid_referer'>referer</span> <span class='op'>||</span> <span class='id identifier rubyid_order_order_detail_path'>order_order_detail_path</span><span class='lparen'>(</span><span class='ivar'>@order</span><span class='comma'>,</span> <span class='ivar'>@order_detail</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="switch_instrument_off!-instance_method">
  
    #<strong>switch_instrument_off!</strong>  &#x21d2; <tt>Object</tt>  <span class="extras">(private)</span>
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


291
292
293
294
295
296
297</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/reservations_controller.rb', line 291</span>

<span class='kw'>def</span> <span class='id identifier rubyid_switch_instrument_off!'>switch_instrument_off!</span>
  <span class='kw'>unless</span> <span class='ivar'>@reservation</span><span class='period'>.</span><span class='id identifier rubyid_other_reservation_using_relay?'>other_reservation_using_relay?</span>
    <span class='const'><span class='object_link'><a href="ReservationInstrumentSwitcher.html" title="ReservationInstrumentSwitcher (class)">ReservationInstrumentSwitcher</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="ReservationInstrumentSwitcher.html#initialize-instance_method" title="ReservationInstrumentSwitcher#initialize (method)">new</a></span></span><span class='lparen'>(</span><span class='ivar'>@reservation</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_switch_off!'><span class='object_link'><a href="ReservationInstrumentSwitcher.html#switch_off!-instance_method" title="ReservationInstrumentSwitcher#switch_off! (method)">switch_off!</a></span></span>
    <span class='id identifier rubyid_flash'>flash</span><span class='lbracket'>[</span><span class='symbol'>:notice</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>The instrument has been deactivated successfully</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_session'>session</span><span class='lbracket'>[</span><span class='symbol'>:reservation_auto_logout</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='kw'>true</span> <span class='kw'>if</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:reservation_ended</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_present?'>present?</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="switch_instrument_on!-instance_method">
  
    #<strong>switch_instrument_on!</strong>  &#x21d2; <tt>Object</tt>  <span class="extras">(private)</span>
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


299
300
301
302
303</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/reservations_controller.rb', line 299</span>

<span class='kw'>def</span> <span class='id identifier rubyid_switch_instrument_on!'>switch_instrument_on!</span>
  <span class='const'><span class='object_link'><a href="ReservationInstrumentSwitcher.html" title="ReservationInstrumentSwitcher (class)">ReservationInstrumentSwitcher</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="ReservationInstrumentSwitcher.html#initialize-instance_method" title="ReservationInstrumentSwitcher#initialize (method)">new</a></span></span><span class='lparen'>(</span><span class='ivar'>@reservation</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_switch_on!'><span class='object_link'><a href="ReservationInstrumentSwitcher.html#switch_on!-instance_method" title="ReservationInstrumentSwitcher#switch_on! (method)">switch_on!</a></span></span>
  <span class='id identifier rubyid_flash'>flash</span><span class='lbracket'>[</span><span class='symbol'>:notice</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>The instrument has been activated successfully</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_session'>session</span><span class='lbracket'>[</span><span class='symbol'>:reservation_auto_logout</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='kw'>true</span> <span class='kw'>if</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:reservation_started</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_present?'>present?</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="upcoming_today?-instance_method">
  
    #<strong>upcoming_today?</strong>(reservation)  &#x21d2; <tt>Boolean</tt>  <span class="extras">(private)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    

  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


386
387
388
389</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/reservations_controller.rb', line 386</span>

<span class='kw'>def</span> <span class='id identifier rubyid_upcoming_today?'>upcoming_today?</span><span class='lparen'>(</span><span class='id identifier rubyid_reservation'>reservation</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_now'>now</span> <span class='op'>=</span> <span class='const'>Time</span><span class='period'>.</span><span class='id identifier rubyid_zone'>zone</span><span class='period'>.</span><span class='id identifier rubyid_now'>now</span>
  <span class='lparen'>(</span><span class='id identifier rubyid_reservation'>reservation</span><span class='period'>.</span><span class='id identifier rubyid_reserve_start_at'>reserve_start_at</span><span class='period'>.</span><span class='id identifier rubyid_to_date'>to_date</span> <span class='op'>==</span> <span class='id identifier rubyid_now'>now</span><span class='period'>.</span><span class='id identifier rubyid_to_date'>to_date</span> <span class='op'>||</span> <span class='id identifier rubyid_reservation'>reservation</span><span class='period'>.</span><span class='id identifier rubyid_reserve_start_at'>reserve_start_at</span> <span class='op'>&lt;</span> <span class='id identifier rubyid_now'>now</span><span class='rparen'>)</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_reservation'>reservation</span><span class='period'>.</span><span class='id identifier rubyid_reserve_end_at'>reserve_end_at</span> <span class='op'>&gt;</span> <span class='id identifier rubyid_now'>now</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="update-instance_method">
  
    #<strong>update</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>PUT  /orders/1/order_details/1/reservations/1</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/reservations_controller.rb', line 170</span>

<span class='kw'>def</span> <span class='id identifier rubyid_update'>update</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_invalid_for_update?'>invalid_for_update?</span>
    <span class='id identifier rubyid_redirect_to'>redirect_to</span> <span class='lbracket'>[</span><span class='ivar'>@order</span><span class='comma'>,</span> <span class='ivar'>@order_detail</span><span class='comma'>,</span> <span class='ivar'>@reservation</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='label'>notice:</span> <span class='const'>I18n</span><span class='period'>.</span><span class='id identifier rubyid_t'>t</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>controllers.reservations.update.failure</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='kw'>return</span>
  <span class='kw'>end</span>

  <span class='ivar'>@reservation</span><span class='period'>.</span><span class='id identifier rubyid_assign_times_from_params'>assign_times_from_params</span><span class='lparen'>(</span><span class='id identifier rubyid_reservation_params'>reservation_params</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_with_dropped_params'>with_dropped_params</span> <span class='kw'>do</span>
    <span class='id identifier rubyid_reservation_update_attributes'>reservation_update_attributes</span> <span class='op'>=</span> <span class='id identifier rubyid_params'>params</span><span class='period'>.</span><span class='id identifier rubyid_require'>require</span><span class='lparen'>(</span><span class='symbol'>:reservation</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_permit'>permit</span><span class='lparen'>(</span><span class='symbol'>:note</span><span class='rparen'>)</span>
    <span class='ivar'>@reservation</span><span class='period'>.</span><span class='id identifier rubyid_assign_attributes'>assign_attributes</span><span class='lparen'>(</span><span class='id identifier rubyid_reservation_update_attributes'>reservation_update_attributes</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_render_edit'>render_edit</span> <span class='op'>&amp;&amp;</span> <span class='kw'>return</span> <span class='kw'>unless</span> <span class='id identifier rubyid_changes_valid_for_update?'>changes_valid_for_update?</span>

  <span class='const'><span class='object_link'><a href="Reservation.html" title="Reservation (class)">Reservation</a></span></span><span class='period'>.</span><span class='id identifier rubyid_transaction'>transaction</span> <span class='kw'>do</span>
    <span class='kw'>begin</span>
      <span class='comment'># merge state can change after call to #save! due to OrderDetailObserver#before_save
</span>      <span class='id identifier rubyid_mergeable'>mergeable</span> <span class='op'>=</span> <span class='ivar'>@order_detail</span><span class='period'>.</span><span class='id identifier rubyid_order'>order</span><span class='period'>.</span><span class='id identifier rubyid_to_be_merged?'>to_be_merged?</span>

      <span class='id identifier rubyid_save_reservation_and_order_detail'>save_reservation_and_order_detail</span>

      <span class='id identifier rubyid_flash'>flash</span><span class='lbracket'>[</span><span class='symbol'>:notice</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>The reservation was successfully updated.</span><span class='tstring_end'>&quot;</span></span>
      <span class='kw'>if</span> <span class='id identifier rubyid_mergeable'>mergeable</span>
        <span class='id identifier rubyid_redirect_to'>redirect_to</span> <span class='id identifier rubyid_facility_order_path'>facility_order_path</span><span class='lparen'>(</span><span class='ivar'>@order_detail</span><span class='period'>.</span><span class='id identifier rubyid_facility'>facility</span><span class='comma'>,</span> <span class='ivar'>@order_detail</span><span class='period'>.</span><span class='id identifier rubyid_order'>order</span><span class='period'>.</span><span class='id identifier rubyid_merge_order'>merge_order</span> <span class='op'>||</span> <span class='ivar'>@order_detail</span><span class='period'>.</span><span class='id identifier rubyid_order'>order</span><span class='rparen'>)</span>
      <span class='kw'>else</span>
        <span class='id identifier rubyid_redirect_to'>redirect_to</span> <span class='lparen'>(</span><span class='ivar'>@order</span><span class='period'>.</span><span class='id identifier rubyid_purchased?'>purchased?</span> <span class='op'>?</span> <span class='id identifier rubyid_reservations_path'>reservations_path</span> <span class='op'>:</span> <span class='id identifier rubyid_cart_path'>cart_path</span><span class='rparen'>)</span>
      <span class='kw'>end</span>
      <span class='kw'>return</span>
    <span class='kw'>rescue</span> <span class='const'><span class='object_link'><a href="ActiveRecord.html" title="ActiveRecord (module)">ActiveRecord</a></span></span><span class='op'>::</span><span class='const'>RecordInvalid</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_e'>e</span>
      <span class='id identifier rubyid_raise'>raise</span> <span class='const'><span class='object_link'><a href="ActiveRecord.html" title="ActiveRecord (module)">ActiveRecord</a></span></span><span class='op'>::</span><span class='const'>Rollback</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_render_edit'>render_edit</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

      <div id="footer">
  Generated on Fri Apr 13 09:52:08 2018 by
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.9.12 (ruby-2.4.1).
</div>

    </div>
  </body>
</html>